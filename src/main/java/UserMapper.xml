<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.smbms.mapper.UserMapper">

    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="com.smbms.entity.User">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <result column="userCode" property="userCode" jdbcType="VARCHAR"/>
        <result column="userName" property="userName" jdbcType="VARCHAR"/>
        <result column="userPassword" property="userPassword" jdbcType="VARCHAR"/>
        <result column="gender" property="gender" jdbcType="INTEGER"/>
        <result column="birthday" property="birthday" jdbcType="DATE"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="userRole" property="userRole" jdbcType="BIGINT"/>
        <result column="createdBy" property="createdBy" jdbcType="BIGINT"/>
        <result column="creationDate" property="creationDate" jdbcType="TIMESTAMP"/>
        <result column="modifyBy" property="modifyBy" jdbcType="BIGINT"/>
        <result column="modifyDate" property="modifyDate" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 基础列名 -->
    <sql id="Base_Column_List">
        id, userCode, userName, userPassword, gender, birthday, phone,
        address, userRole, createdBy, creationDate, modifyBy, modifyDate
    </sql>

    <!-- 添加用户 -->
    <insert id="insertUser" parameterType="com.smbms.entity.User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO smbms_user (
        userCode, userName, userPassword, gender, birthday, phone,
        address, userRole, createdBy, creationDate, modifyBy, modifyDate
        ) VALUES (
        #{userCode}, #{userName}, #{userPassword}, #{gender}, #{birthday}, #{phone},
        #{address}, #{userRole}, #{createdBy}, #{creationDate}, #{modifyBy}, #{modifyDate}
        )
    </insert>

    <!-- 根据ID删除用户 -->
    <delete id="deleteUserById" parameterType="java.lang.Long">
        DELETE FROM smbms_user
        WHERE id = #{id}
    </delete>

    <!-- 更新用户信息 -->
    <update id="updateUser" parameterType="com.smbms.entity.User">
        UPDATE smbms_user
        <set>
            <if test="userCode != null">userCode = #{userCode},</if>
            <if test="userName != null">userName = #{userName},</if>
            <if test="userPassword != null">userPassword = #{userPassword},</if>
            <if test="gender != null">gender = #{gender},</if>
            <if test="birthday != null">birthday = #{birthday},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="address != null">address = #{address},</if>
            <if test="userRole != null">userRole = #{userRole},</if>
            <if test="createdBy != null">createdBy = #{createdBy},</if>
            <if test="creationDate != null">creationDate = #{creationDate},</if>
            <if test="modifyBy != null">modifyBy = #{modifyBy},</if>
            <if test="modifyDate != null">modifyDate = #{modifyDate},</if>
        </set>
        WHERE id = #{id}
    </update>

    <!-- 根据ID查询用户 -->
    <select id="selectUserById" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        WHERE id = #{id}
    </select>

    <!-- 查询所有用户 -->
    <select id="selectAllUsers" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
    </select>

    <!-- 根据用户编码查询用户 -->
    <select id="selectUserByUserCode" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        WHERE userCode = #{userCode}
    </select>

    <!-- 根据用户名模糊查询 -->
    <select id="selectUsersByUserName" parameterType="java.lang.String" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        WHERE userName LIKE CONCAT('%', #{userName}, '%')
    </select>

    <!-- 根据用户角色查询 -->
    <select id="selectUsersByRole" parameterType="java.lang.Long" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        WHERE userRole = #{userRole}
    </select>

    <!-- 用户登录验证 -->
    <select id="login" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        WHERE userCode = #{userCode} AND userPassword = #{userPassword}
    </select>

    <!-- 分页查询用户 -->
    <select id="selectUsersByPage" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM smbms_user
        ORDER BY id DESC
        LIMIT #{start}, #{pageSize}
    </select>

    <!-- 查询用户总数 -->
    <select id="selectUserCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM smbms_user
    </select>

</mapper>